<!DOCTYPE html><html lang="zh-Hant"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSQ-60 互動問卷 (增強版)</title>
    <style>
        :root {
            --primary-color: #005a9c;
            --secondary-color: #f0f8ff;
            --text-color: #333;
            --border-color: #ccc;
            --error-color: #d9534f;
            --success-color: #28a745;
            --adaptive-color: #5cb85c;
            --affect-color: #f0ad4e;
            --image-color: #d9534f;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: auto;
            background: #fff;
            padding: 20px 30px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h1, h2 {
            color: var(--primary-color);
            text-align: center;
        }

        .instructions, .user-info-section {
            background-color: var(--secondary-color);
            border-left: 5px solid var(--primary-color);
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 4px;
        }

        .user-info-section .form-group {
            margin-bottom: 15px;
        }

        .user-info-section label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .user-info-section input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .user-info-section input.unanswered {
            border-color: var(--error-color);
            background-color: #fff5f5;
        }

        .scale-info {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
            flex-wrap: wrap;
        }

        .question-block {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .question-block.unanswered {
            background-color: #fff5f5;
            border-color: var(--error-color);
        }

        .question-text {
            margin-bottom: 10px;
            font-weight: 500;
        }

        .likert-scale {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
        }

        .likert-scale label {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
            min-width: 30px;
            text-align: center;
        }

        .likert-scale input[type="radio"] {
            opacity: 0;
            position: absolute;
            width: 0;
            height: 0;
        }
        
        .likert-scale .radio-label {
            display: block;
            padding: 5px 10px;
            border: 1px solid var(--border-color);
            border-radius: 50px;
            background-color: #fff;
        }
        
        .likert-scale input[type="radio"]:checked ~ .radio-label {
            background-color: var(--primary-color);
            color: #fff;
            border-color: var(--primary-color);
        }

        .submit-button, .download-button {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 20px;
        }

        .submit-button {
            background-color: var(--success-color);
        }

        .submit-button:hover {
            background-color: #218838;
        }
        
        .download-button {
            background-color: var(--primary-color);
        }
        
        .download-button:hover {
            background-color: #00457c;
        }

        #results {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        
        .result-item {
            margin-bottom: 20px;
        }

        .result-item h3 {
            margin-bottom: 5px;
        }
        
        .progress-bar-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 50px;
            height: 25px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            border-radius: 50px;
            transition: width 1.5s ease-in-out;
        }
        
        .progress-bar.adaptive { background-color: var(--adaptive-color); }
        .progress-bar.affect { background-color: var(--affect-color); }
        .progress-bar.image { background-color: var(--image-color); }

        .result-interpretation {
            font-size: 0.9em;
            margin-top: 8px;
            color: #666;
        }
        
        details {
            margin-top: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
        }
        
        summary {
            font-weight: bold;
            cursor: pointer;
            color: var(--primary-color);
        }
        
        .subscale-results {
            margin-top: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 8px;
            font-size: 0.9em;
        }

        #error-message {
            color: var(--error-color);
            text-align: center;
            font-weight: bold;
            margin-top: 15px;
            display: none;
        }
    </style>
<script src="https://puc.poecdn.net/authenticated_preview_page/syncedState.3f7572448765332f3047.js"></script></head>
<body>

    <div class="container">
        <h1>DSQ-60 互動問卷 (增強版)</h1>
        
        <div class="user-info-section">
            <h2>個人資料</h2>
            <div class="form-group">
                <label for="participant-name">姓名</label>
                <input type="text" id="participant-name" name="participant-name" placeholder="請輸入你的姓名">
            </div>
            <div class="form-group">
                <label for="participant-email">電郵地址</label>
                <input type="email" id="participant-email" name="participant-email" placeholder="請輸入你的電郵地址">
            </div>
        </div>

        <div class="instructions">
            <h2>問卷說明</h2>
            <p>本問卷旨在了解個人對自己的看法。請根據以下九點量表，指出每個項目在多大程度上適用於你。</p>
            <p>答案沒有對錯之分，請回答全部60條問題。</p>
        </div>

        <div class="scale-info">
            <span>1 = 完全不適用於我</span>
            <span>9 = 完全適用於我</span>
        </div>

        <form id="dsq-form">
            <!-- Questions will be dynamically inserted here by JavaScript -->
        </form>

        <button type="button" id="calculate-btn" class="submit-button">計算我的分數</button>
        <p id="error-message"></p>

        <div id="results">
            <h2 id="results-title">你的結果</h2>
            
            <div class="result-item">
                <h3>適應型風格 (Adaptive Style)</h3>
                <div class="progress-bar-container">
                    <div class="progress-bar adaptive" id="adaptive-bar"></div>
                </div>
                <p class="result-interpretation">
                    <strong>風格解釋：</strong>此風格反映出健康、成熟及具建設性的方式來應對壓力、衝突和困難情緒。高分者傾向能靈活處理挑戰，例如尋求支援、制定計劃、運用幽默感，並將精力轉化為有建設性的活動。
                </p>
                <details>
                    <summary>顯示詳細防衛機制分數</summary>
                    <div class="subscale-results" id="adaptive-subscales"></div>
                </details>
            </div>

            <div class="result-item">
                <h3>情感調節型風格 (Affect-Regulating Style)</h3>
                <div class="progress-bar-container">
                    <div class="progress-bar affect" id="affect-bar"></div>
                </div>
                 <p class="result-interpretation">
                    <strong>風格解釋：</strong>此風格透過將困擾的情緒排除在意識之外來進行管理。相關的防衛機制可能包括將感受理智化、與情境保持情感距離，或為衝突作出合理解釋。雖然此風格有時有用，但過度依賴可能會抑制情感表達和自我覺察。
                </p>
                <details>
                    <summary>顯示詳細防衛機制分數</summary>
                    <div class="subscale-results" id="affect-subscales"></div>
                </details>
            </div>

            <div class="result-item">
                <h3>影像扭曲型風格 (Image-Distorting Style)</h3>
                <div class="progress-bar-container">
                    <div class="progress-bar image" id="image-bar"></div>
                </div>
                 <p class="result-interpretation">
                    <strong>風格解釋：</strong>此風格透過扭曲對自己或他人的看法來處理內心困擾。這可能包括以黑白分明的角度看待人或事（非好即壞）、指責他人或衝動行事。高分者通常與人際關係困難和較無效的應對策略有關。
                </p>
                <details>
                    <summary>顯示詳細防衛機制分數</summary>
                    <div class="subscale-results" id="image-subscales"></div>
                </details>
            </div>
            
            <button type="button" id="download-btn" class="download-button">匯出並下載結果</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const questions = [
                "1. 我從幫助他人中獲得滿足感，如果無法這樣做，我會感到沮喪。", "2. 人們常說我會鬧彆扭／生悶氣。", "3. 我能夠暫時將問題拋諸腦後，直到我有時間處理它為止。", "4. 我透過做一些有建設性和創造性的事（如繪畫或木工）來排解我的焦慮。", "5. 我對人的看法經常改變；一時之間我會高度評價他們，另一時間我又覺得他們一文不值。", "6. 我總能為自己做的每件事找到合理的理由。", "7. 我能夠輕易地自嘲。", "8. 我覺得人們傾向於虧待我。", "9. 如果有人搶劫並偷了我的錢，我寧願他得到幫助而不是懲罰。", "10. 當我與人發生衝突時，我會嘗試思考自己在哪方面有責任。", "11. 人們說我傾向於忽略不愉快的事實，彷彿它們不存在一樣。", "12. 我時常覺得自己比身邊的人優越。", "13. 有人正在情感上榨乾我的一切。", "14. 當遇到真正的危險時，我彷彿置身事外，感覺不到恐懼。", "15. 如果我受到不公平對待，我會挺身而出捍衛自己的權利。", "16. 我應對危險時，就像自己是超人一樣。", "17. 我為自己能夠挫他人的銳氣而感到自豪。", "18. 當有事情困擾我時，我常常會衝動行事。", "19. 事實上，我頗沒有價值。", "20. 與人相處時，他們最終往往會感受到我的感受。", "21. 我從幻想中得到的滿足感比從現實生活中得到的更多。", "22. 當我生氣時，我會選擇退縮。", "23. 當我身處困境時，我時常感到不真實。", "24. 我擁有特殊才能，讓我可以毫無問題地度過一生。", "25. 我寧願談論抽象的事情，也不願談論我的感受。", "26. 當事情不順利時，總是有很好的理由可以解釋。", "27. 我在白日夢中解決的事情比在現實生活中更多。", "28. 當別人生我的氣時，我傾向於認為他們小題大作。", "29. 有時我覺得自己是天使，有時又覺得自己是魔鬼。", "30. 如果有人對我生氣，我會因為一些平常不在意的事情而感到煩惱。", "31. 當我感到受傷時，我會變得公然地具攻擊性。", "32. 我幾乎不記得任何關於我早年上學的事情。", "33. 當我悲傷時，我會選擇退縮。", "34. 我總覺得我認識的某個人就像一位守護天使。", "35. 事實上，我比人們想像的還要差。", "36. 對我來說，人要麼是好人，要麼是壞人。", "37. 如果我的上司惹惱我，我可能會在工作中犯錯或故意放慢工作速度來報復他。", "38. 我認識一個人，他無所不能，而且絕對公平公正。", "39. 如果我經歷了不愉快的事情，第二天有時我會忘記那是什麼事。", "40. 幫助他人讓我感覺良好。", "41. 如果表達感受會干擾我正在做的事，我能夠抑制自己的情緒。", "42. 在痛苦的困境中，我通常能看到其中有趣的一面。", "43. 我常常發現自己對那些理應讓我生氣的人非常友善。", "44. 沒有「在每個人身上找到一點好處」這回事，如果你是壞人，你就是徹頭徹尾的壞人。", "45. 當我做的事情結果不佳時，我會試圖找出我可能忽略了什麼。", "46. 我覺得人們傾向於對我不誠實。", "47. 當我必須面對困難情況時，我會嘗試想像那會是怎樣的，並計劃應對方法。", "48. 醫生從來沒有真正了解我的問題出在哪裡。", "49. 在我為自己的權利抗爭後，我傾向於為自己的堅定立場道歉。", "50. 如果有人惹惱我，我會告訴他們，但不會傷害他們的感情。", "51. 我經常被告知我不表露自己的感受。", "52. 當我心情不好時，我會想和別人在一起。", "53. 如果我能預先知道自己將會難過，我就能更好地應對。", "54. 無論我怎樣投訴，都從未得到滿意的回應。", "55. 我不會直接說出我的感受，而是會詳細地解釋我的想法。", "56. 在理應有強烈情緒反應的情況下，我常常發現自己沒有任何感覺。", "57. 當我感到沮喪或焦慮時，我喜歡從事一些創造性或體能活動。", "58. 如果我陷入危機，我會找人傾訴我的憂慮。", "59. 當我有一個具攻擊性的想法時，我覺得有必要做些事情來彌補它。", "60. 當有令人興奮的事情發生時，我卻傾向於為一些不重要的細節而煩惱。"
            ];

            const form = document.getElementById('dsq-form');
            let questionHTML = '';
            questions.forEach((qText, index) => {
                const qNum = index + 1;
                questionHTML += `<div class="question-block" id="q-block-${qNum}">`;
                questionHTML += `<p class="question-text">${qText}</p>`;
                questionHTML += `<div class="likert-scale">`;
                for (let i = 1; i <= 9; i++) {
                    questionHTML += `<label><input type="radio" name="q${qNum}" value="${i}"><span class="radio-label">${i}</span></label>`;
                }
                questionHTML += `</div></div>`;
            });
            form.innerHTML = questionHTML;

            const scoringKey = {
                defenses: {
                    actingOut: [18, 31], affiliation: [52, 58], altruism: [9, 40], anticipation: [47, 53], denial: [11, 28],
                    devaluationOfOther: [17, 44], devaluationOfSelf: [19, 35], displacement: [30, 37], dissociation: [14, 23],
                    fantasy: [21, 27], helpRejectingComplaining: [48, 54], humor: [7, 42], idealization: [34, 38],
                    intellectualization: [25, 55], isolation: [51, 56], omnipotence: [16, 24], passiveAggressive: [2, 22],
                    projection: [8, 46], projectiveIdentification: [13, 20], rationalization: [6, 26], reactionFormation: [1, 43],
                    repression: [32, 39], selfAssertion: [15, 50], selfObservation: [10, 45], splittingOfOther: [5, 36],
                    splittingOfSelf: [29, 49], sublimation: [4, 57], suppression: [3, 41], undoing: [59, 60], withdrawal: [12, 33]
                },
                styles: {
                    imageDistorting: ['splittingOfOther', 'projection', 'denial', 'devaluationOfOther', 'projectiveIdentification', 'omnipotence', 'devaluationOfSelf', 'fantasy', 'splittingOfSelf', 'idealization', 'actingOut', 'displacement', 'passiveAggressive', 'withdrawal', 'helpRejectingComplaining'],
                    affectRegulating: ['undoing', 'isolation', 'intellectualization', 'dissociation', 'rationalization', 'reactionFormation', 'repression'],
                    adaptive: ['sublimation', 'suppression', 'anticipation', 'humor', 'selfAssertion', 'selfObservation', 'affiliation', 'altruism']
                },
                defenseNames: {
                    actingOut: "行動化 (Acting Out)", affiliation: "親和 (Affiliation)", altruism: "利他主義 (Altruism)", anticipation: "預期 (Anticipation)", denial: "否定 (Denial)",
                    devaluationOfOther: "貶低他人 (Devaluation of Other)", devaluationOfSelf: "貶低自己 (Devaluation of Self)", displacement: "轉移 (Displacement)", dissociation: "解離 (Dissociation)",
                    fantasy: "幻想 (Fantasy)", helpRejectingComplaining: "拒助-抱怨 (Help-Rejecting Complaining)", humor: "幽默 (Humor)", idealization: "理想化 (Idealization)",
                    intellectualization: "理智化 (Intellectualization)", isolation: "情感隔離 (Isolation)", omnipotence: "全能感 (Omnipotence)", passiveAggressive: "被動攻擊 (Passive-Aggressive)",
                    projection: "投射 (Projection)", projectiveIdentification: "投射性認同 (Projective Identification)", rationalization: "合理化 (Rationalization)", reactionFormation: "反向形成 (Reaction Formation)",
                    repression: "潛抑 (Repression)", selfAssertion: "自我肯定 (Self-Assertion)", selfObservation: "自我觀察 (Self-Observation)", splittingOfOther: "分裂他人 (Splitting of Other)",
                    splittingOfSelf: "分裂自我 (Splitting of Self)", sublimation: "昇華 (Sublimation)", suppression: "壓抑 (Suppression)", undoing: "抵消 (Undoing)", withdrawal: "退縮 (Withdrawal)"
                }
            };
            
            let finalResults = {}; // To store results for download

            document.getElementById('calculate-btn').addEventListener('click', function() {
                const nameInput = document.getElementById('participant-name');
                const emailInput = document.getElementById('participant-email');
                const name = nameInput.value.trim();
                const email = emailInput.value.trim();
                
                let errors = [];
                nameInput.classList.remove('unanswered');
                emailInput.classList.remove('unanswered');
                
                if (!name) {
                    errors.push('請輸入你的姓名。');
                    nameInput.classList.add('unanswered');
                }
                if (!email) {
                    errors.push('請輸入你的電郵地址。');
                    emailInput.classList.add('unanswered');
                } else if (!/^\S+@\S+\.\S+$/.test(email)) {
                    errors.push('請輸入有效的電郵地址。');
                    emailInput.classList.add('unanswered');
                }

                const answers = {};
                let allQuestionsAnswered = true;
                document.querySelectorAll('.question-block').forEach(block => block.classList.remove('unanswered'));
                
                for (let i = 1; i <= 60; i++) {
                    const selected = document.querySelector(`input[name="q${i}"]:checked`);
                    if (selected) {
                        answers[i] = parseInt(selected.value);
                    } else {
                        allQuestionsAnswered = false;
                        document.getElementById(`q-block-${i}`).classList.add('unanswered');
                    }
                }

                if (!allQuestionsAnswered) {
                    errors.push('請回答全部60條問題。');
                }

                const errorMessage = document.getElementById('error-message');
                if (errors.length > 0) {
                    errorMessage.innerHTML = errors.join('<br>');
                    errorMessage.style.display = 'block';
                    const firstUnanswered = document.querySelector('.unanswered');
                    if (firstUnanswered) {
                        firstUnanswered.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                    return;
                }
                errorMessage.style.display = 'none';

                const defenseScores = {};
                for (const defense in scoringKey.defenses) {
                    const [item1, item2] = scoringKey.defenses[defense];
                    defenseScores[defense] = (answers[item1] + answers[item2]) / 2;
                }

                const styleScores = {};
                for (const style in scoringKey.styles) {
                    let total = 0;
                    const defenseList = scoringKey.styles[style];
                    defenseList.forEach(defense => {
                        total += defenseScores[defense];
                    });
                    styleScores[style] = total / defenseList.length;
                }

                finalResults = { name, email, styleScores, defenseScores }; // Store for download

                document.getElementById('results-title').textContent = `${name}的結果`;

                // Display main scores
                const adaptiveScore = styleScores.adaptive.toFixed(2);
                const affectScore = styleScores.affectRegulating.toFixed(2);
                const imageScore = styleScores.imageDistorting.toFixed(2);

                const adaptiveBar = document.getElementById('adaptive-bar');
                const affectBar = document.getElementById('affect-bar');
                const imageBar = document.getElementById('image-bar');

                adaptiveBar.textContent = `平均分: ${adaptiveScore} / 9`;
                affectBar.textContent = `平均分: ${affectScore} / 9`;
                imageBar.textContent = `平均分: ${imageScore} / 9`;

                setTimeout(() => {
                    adaptiveBar.style.width = (adaptiveScore / 9) * 100 + '%';
                    affectBar.style.width = (affectScore / 9) * 100 + '%';
                    imageBar.style.width = (imageScore / 9) * 100 + '%';
                }, 100);

                // Display subscale scores
                const displaySubscales = (styleName, containerId) => {
                    const container = document.getElementById(containerId);
                    container.innerHTML = '';
                    const defenseList = scoringKey.styles[styleName];
                    defenseList.sort().forEach(defense => {
                        const score = defenseScores[defense].toFixed(2);
                        const defenseName = scoringKey.defenseNames[defense] || defense;
                        container.innerHTML += `<div>${defenseName}: <strong>${score}</strong></div>`;
                    });
                };

                displaySubscales('adaptive', 'adaptive-subscales');
                displaySubscales('affectRegulating', 'affect-subscales');
                displaySubscales('imageDistorting', 'image-subscales');

                const resultsDiv = document.getElementById('results');
                resultsDiv.style.display = 'block';
                resultsDiv.scrollIntoView({ behavior: 'smooth' });
            });

            document.getElementById('download-btn').addEventListener('click', function() {
                if (!finalResults.name) return;

                let reportText = `DSQ-60 結果報告\n`;
                reportText += `====================================\n\n`;
                reportText += `姓名: ${finalResults.name}\n`;
                reportText += `電郵地址: ${finalResults.email}\n`;
                reportText += `報告生成時間: ${new Date().toLocaleString('zh-HK')}\n\n`;

                reportText += `主要防衛風格分數\n`;
                reportText += `--------------------------\n`;
                reportText += `適應型風格 (Adaptive Style): ${finalResults.styleScores.adaptive.toFixed(2)} / 9\n`;
                reportText += `情感調節型風格 (Affect-Regulating Style): ${finalResults.styleScores.affectRegulating.toFixed(2)} / 9\n`;
                reportText += `影像扭曲型風格 (Image-Distorting Style): ${finalResults.styleScores.imageDistorting.toFixed(2)} / 9\n\n`;

                const generateSubscaleText = (styleName, title) => {
                    let text = `${title}\n--------------------------\n`;
                    const defenseList = scoringKey.styles[styleName];
                    defenseList.sort().forEach(defense => {
                        const score = finalResults.defenseScores[defense].toFixed(2);
                        const defenseName = scoringKey.defenseNames[defense] || defense;
                        text += `${defenseName}: ${score}\n`;
                    });
                    return text + '\n';
                };

                reportText += generateSubscaleText('adaptive', '詳細分數: 適應型風格');
                reportText += generateSubscaleText('affectRegulating', '詳細分數: 情感調節型風格');
                reportText += generateSubscaleText('imageDistorting', '詳細分數: 影像扭曲型風格');
                
                const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `DSQ-60_結果_${finalResults.name.replace(/ /g, '_')}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        });
    </script>


</body></html>
